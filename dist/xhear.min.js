(e=>{function t(e,t){v(this,{type:{enumerable:!0,value:e},keys:{enumerable:!0,value:[]},target:{enumerable:!0,value:t},bubble:{enumerable:!0,writable:!0,value:!0},cancel:{enumerable:!0,writable:!0,value:!1},currentTarget:{enumerable:!0,writable:!0,value:t}})}function r(e){this.type="watch",b(this,e)}function s(e,t={}){let r=new Proxy(this,B),s=0;Object.keys(e).forEach(t=>{let n=e[t];/\D/.test(t)||(t=parseInt(t))>=s&&(s=t+1),this[t]=T(n,{parent:r,hostkey:t})});return h(this,{length:s,[I]:{},[_]:{},[C]:[],[S]:[],[N]:""}),v(this,{status:{writable:!0,value:t.parent?"binding":"root"},parent:{writable:!0,value:t.parent},hostkey:{writable:!0,value:t.hostkey}}),r}const n=()=>Math.random().toString(32).substr(2);let i=Object.prototype.toString;const a=e=>i.call(e).toLowerCase().replace(/(\[object )|(])/g,""),l=e=>void 0===e,o=e=>JSON.parse(JSON.stringify(e)),h=(e,t)=>{for(let r in t)g(e,r,{writable:!0,value:t[r]})},c=(()=>{let e=!1,t=[];return r=>{e||(e=!0,setTimeout(()=>{for(let e=0;e<t.length;e++)t[e]();t=[],e=!1},0)),t.push(r)}})(),d=(n(),"_xevent_"+n()),u="_exkeys_"+n(),f="_attached_"+n(),y="_detached_"+n(),p="_xheardata_"+n(),m=new Map;let{defineProperty:g,defineProperties:v,assign:b}=Object;const k=e=>{let t=e;for(;t.xvRender;){let e=t[p];if(e){let{$content:r}=e;if(!r)break;t=r.ele}}return t},w=(e,t)=>{if(e===t)return!0;let r=document.createElement("div");return e!==document&&(r.appendChild(e.cloneNode(!1)),!!r.querySelector(t))},x=e=>{let t=e.querySelectorAll("[xv-ele]");Array.from(t).forEach(e=>{Z(e)});let r=e.getAttribute("xv-ele");l(r)||null===r||Z(e)},E=e=>{if(e.tag&&!(e instanceof U)){let t=document.createElement(e.tag);e.class&&t.setAttribute("class",e.class),e.text&&(t.textContent=e.text);let r,{xvele:s}=e;s&&(t.setAttribute("xv-ele",""),Z(t),(r=A(t))[u].forEach(t=>{let s=e[t];!l(s)&&(r[t]=s)}));let n=0;for(;n in e;){let i=E(e[n]);if(s&&r){let{$content:e}=r;e&&e.ele.appendChild(i)}else t.appendChild(i);n++}return t}},A=e=>{if(!e)return;let t=e[p];t||(t=new U(e),e[p]=t);let r=Object.create(t);return v(r,{ele:{enumerable:!1,value:e}}),r=new Proxy(r,J)},O=e=>{if(e instanceof U)return e;let t,r=a(e);return e instanceof Element?(x(e),t=A(e)):"string"==r?(t=(e=>{let t=document.createElement("div");t.innerHTML=e;return Array.from(t.childNodes).filter(function(e){if(!(e instanceof Text)||e.textContent&&e.textContent.trim())return e})})(e)[0],x(t),t=A(t)):"object"==r&&(t=E(e),t=A(t)),t},I="_eves_"+n(),j="_runarrmethod_"+n(),_="_watch_"+n(),C="_synchost_"+n(),S="_modify_"+n(),N="_modify_timer_"+n();let q=e=>e instanceof s;const T=(e,t)=>{let r=e;switch(a(e)){case"object":case"array":r=new s(e,t)}return r},M=e=>{q(e)&&(e.parent=null,e.hostkey=null,e.status="readyDestory",c(()=>{e.parent&&e.hostkey&&"root"!=e.status?e.status="binding":(e[C].forEach(t=>{e.unsync(t.opp)}),e[_]={},e[I]={},e[S]=[],clearTimeout(e[N]))}))};let R=(e,t)=>{if(e===t)return!0};const $=(e,t)=>{t.forEach(t=>{switch(t.type){case"map":l(e[t.key])||(e[t.toKey]=e[t.key],delete e[t.key])}});for(let r in e){let s=e[r];s instanceof Object&&$(s,t)}},L=(e,t,r,s,n)=>{let i=0;switch(r){case"keyValue":let l=n[e];switch(s){case"=":l==t&&(i=1);break;case":=":q(l)&&l.findIndex(e=>e==t)>-1&&(i=1);break;case"*=":"string"==a(l)&&l.search(t)>-1&&(i=1);break;case"~=":"string"==a(l)&&l.split(" ").findIndex(e=>e==t)>-1&&(i=1)}break;case"hasValue":switch(s){case"=":Object.values(n).findIndex(e=>e==t)>-1&&(i=1);break;case":=":Object.values(n).some(e=>{if(q(e)&&e.findIndex(e=>e==t)>-1)return i=1,!0});break;case"*=":Object.values(n).some(e=>{if("string"==a(e)&&e.search(t)>-1)return i=1,!0});break;case"~=":Object.values(n).some(e=>{if("string"==a(e)&&e.split(" ").findIndex(e=>e==t)>-1)return i=1,!0})}break;case"hasKey":n.hasOwnProperty(e)&&(i=1)}return i};let P=(e,t)=>{let r=[],s=t.k,n=t.v,i=t.type,a=t.eqType;return Object.keys(e).forEach(l=>{let o=e[l];if(q(o)){L(s,n,i,a,o)&&r.push(o);let e=P(o,t);r.push(...e)}}),r},D=(e,t)=>{let r=e[S];r.push(t),clearTimeout(e[N]),e[N]=setTimeout(()=>{r.length=0,r=null},5e3)},K=e=>{let{_entrendModifyId:t}=e;return t?delete e._entrendModifyId:(t=n(),D(e,t)),t};v(t.prototype,{trend:{get(){let{modify:e}=this;if(!e)return;let t={genre:e.genre,keys:this.keys.slice()};switch(g(t,"oldVal",{value:e.oldVal}),e.genre){case"arrayMethod":var{methodName:r,args:s,modifyId:n}=e;b(t,{methodName:r,args:s,modifyId:n});break;default:var{value:i,modifyId:n}=e;q(i)&&(i=i.object),b(t,{key:e.key,value:i,modifyId:n})}return t}}});let V=s.prototype={};["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","includes"].forEach(e=>{let t=Array.prototype[e];t&&g(V,e,{writable:!0,value(...e){return t.apply(this,e)}})}),["pop","push","reverse","splice","shift","unshift"].forEach(e=>{let r=Array.prototype[e];r&&g(V,e,{writable:!0,value(...s){this[j]=1;let n=K(this),i=r.apply(this,s);switch(e){case"shift":case"pop":case"splice":i.forEach(e=>{M(e)})}let a=new t("update",this);switch(e){case"splice":case"unshift":case"push":s=s.map(e=>q(e)?e.object:e)}return a.modify={genre:"arrayMethod",methodName:e,args:s,modifyId:n},this.emit(a),delete this[j],i}})});const H=(e,t)=>{let r=e[I];return r[t]||(r[t]=[])},F=Array.prototype.sort;h(V,{sort(e){this[j]=1;let r,s=K(this);if(e instanceof Array){r=[e];let t=Array.from(this);e.forEach((e,r)=>{this[r]=t[e]})}else{let t=[];r=[t];let s=Array.from(this);F.call(this,e),this.forEach(e=>t.push(s.indexOf(e)))}let n=new t("update",this);return n.modify={genre:"arrayMethod",methodName:"sort",args:r,modifyId:s},this.emit(n),delete this[j],this},on(e,t,r={}){let s=H(this,e),n=r.id;if(!l(n)){let e=s.findIndex(e=>e.eventId==n);e>-1&&s.splice(e,1)}return t&&s.push({callback:t,eventId:r.id,onData:r.data,one:r.one}),this},one(e,t,r={}){return r.one=1,this.on(e,t,r)},off(e,t,r={}){let s=H(this,e);return s.some((e,n)=>{if(e.callback===t&&e.eventId===r.id&&e.onData===r.data)return s.splice(n,1),!0}),this},emit(e,r,s={}){let n,i;e instanceof t?(i=e,e=e.type):i=new t(e,this),0==s.bubble&&(i.bubble=!1),i.currentTarget=this,n=H(this,e);let a=0;if(Array.from(n).some((e,t)=>{if(i.cancel)return!0;let s=[i];!l(e.onData)&&(i.data=e.onData),!l(e.eventId)&&(i.eventId=e.eventId),!l(e.one)&&(i.one=e.one),!l(r)&&s.push(r),e.callback.apply(this,s),delete i.data,delete i.eventId,delete i.one,e.one&&(n.splice(t-a,1),a++)}),i.bubble&&!i.cancel){let{parent:e}=this;e&&(i.keys.unshift(this.hostkey),e.emit(i,r))}return this},seek(e){let t,r=[],s=e.match(/(^[^\[\]])\[.+\]/);s&&s.length>=2&&(t=s[1]);e.match(/\[.+?\]/g).forEach(e=>{let t=(e=e.replace(/\[|\]/g,"")).split(/(=|\*=|:=|~=)/),s=t[0];switch(t.length){case 3:s?r.push({type:"keyValue",k:s,eqType:t[1],v:t[2]}):r.push({type:"hasValue",eqType:t[1],v:t[2]});break;case 1:r.push({type:"hasKey",k:s})}});let n;return r.forEach((e,t)=>{let r=e.k,s=e.v,i=e.type,a=e.eqType;switch(t){case 0:n=P(this,e);break;default:n=n.filter(e=>L(r,s,i,a,e)?e:void 0)}}),t&&(n=n.filter(e=>e.hostkey==t?e:void 0)),n},entrend(e){let t=this,{modifyId:r}=e;if(e.keys.forEach(e=>{t=t[e]}),r){if(this[S].includes(r))return this;D(this,r),t._entrendModifyId=r}switch(e.genre){case"arrayMethod":t[e.methodName](...e.args);break;case"delete":delete t[e.key];break;default:t[e.key]=e.value}return r&&delete t._entrendModifyId,this},watch(e,t){let s=a(e);/function/.test(s)&&(t=e,e="_");let n;n="_"==e?"watchOri":/\[.+\]/.test(e)?"seekOri":"watchKey";let i=this[_][e]||(this[_][e]={isNextTick:0,arr:[],modifys:[]});if(i.updateFunc||this.on("update",i.updateFunc=(t=>{switch(n){case"watchOri":i.modifys.push(t.trend);break;case"watchKey":let r=t.keys[0];if(l(r)&&(r=t.modify.key),r!=e)return;l(r)||r!=e||i.modifys.push(t.trend)}i.isNextTick||(i.isNextTick=1,c(()=>{switch(n){case"watchOri":i.arr.forEach(e=>{e.call(this,new r({modifys:Array.from(i.modifys)}))}),i.modifys.length=0;break;case"watchKey":i.arr.forEach(t=>{t.call(this,new r({expr:e,val:this[e],modifys:Array.from(i.modifys)}))}),i.modifys.length=0;break;case"seekOri":let t=this.seek(e),{oldVals:s}=i,a=1;t.length!=s.length&&(a=0),a&&t.some((e,t)=>{if(!R(s[t],e))return a=0,!0}),a||(i.arr.forEach(n=>{n.call(this,new r({expr:e,old:s,val:t}))}),i.oldVals=t)}i.isNextTick=0}))})),i.arr.push(t),"seekOri"==n){let s=this.seek(e);t(new r({expr:e,val:s})),i.oldVals=s}return this},unwatch(e,t){let r=a(e);/function/.test(r)&&(t=e,e="_");let s=this[_][e];if(s){let r=s.arr.indexOf(t);r>-1&&s.arr.splice(r,1),s.arr.length||(this.off("update",s.updateFunc),delete s.updateFunc,delete this[_][e])}return this},sync(e,t){let r,s;switch(a(t)){case"string":this.watch(r=(r=>{r.modifys.forEach(r=>{(l(r.keys[0])?r.key:r.keys[0])==t&&e.entrend(r)})})),e.watch(s=(e=>{e.modifys.forEach(e=>{(l(e.keys[0])?e.key:e.keys[0])==t&&this.entrend(e)})}));break;case"array":this.watch(r=(r=>{r.modifys.forEach(r=>{let s=l(r.keys[0])?r.key:r.keys[0];t.includes(s)&&e.entrend(r)})})),e.watch(s=(e=>{e.modifys.forEach(e=>{let r=l(e.keys[0])?e.key:e.keys[0];t.includes(r)&&this.entrend(e)})}));break;case"object":let n={};Object.keys(t).forEach(e=>{n[t[e]]=e}),this.watch(r=(r=>{r.modifys.forEach(r=>{let s=(r=o(r)).keys[0];s=l(s)?r.key:s,t.hasOwnProperty(s)&&(l(r.keys[0])?r.key=t[s]:r.keys[0]=t[s],e.entrend(r))})})),e.watch(r=(e=>{e.modifys.forEach(e=>{let t=(e=o(e)).keys[0];t=l(t)?e.key:t,n.hasOwnProperty(t)&&(l(e.keys[0])?e.key=n[t]:e.keys[0]=n[t],this.entrend(e))})}));break;default:this.watch(r=(t=>{t.modifys.forEach(t=>{e.entrend(t)})})),e.watch(s=(e=>{e.modifys.forEach(e=>{this.entrend(e)})}))}return this[C].push({opp:e,oppWatchFunc:s,watchFunc:r}),this},unsync(e){let t=this[C].findIndex(t=>t.opp==e);if(t>-1){let e=this[C][t];this.unwatch(e.watchFunc),e.opp.unwatch(e.oppWatchFunc),this[C].splice(t,1)}else console.warn("not found => ",e);return this},virData(e){let t=this.object;$(t,e);let r={},s={};e.forEach(e=>{switch(e.type){case"map":r[e.key]=e.toKey,s[e.toKey]=e.key}}),t=T(t);let n;return this.on("update",n=(e=>{let{trend:s}=e,n=r[s.key];l(n)||(s.key=n,t.entrend(s))})),t.on("update",e=>{let{trend:t}=e,r=s[t.key];l(r)||(t.key=r,this.entrend(t))}),g(t,"remove",{value(...e){e.length||this.off("update",n),V.remove.call(t,...e)}}),t},removeByKey(e){/\D/.test(e)?delete this[e]:this.splice(parseInt(e),1)},remove(e){if(l(e)){let{parent:e}=this;e?e.removeByKey(this.hostkey):M(this)}else if(q(e))e.parent==this&&this.removeByKey(e.hostkey);else{let t=this.indexOf(e);t>-1&&this.removeByKey(t)}},clone(){return T(this.object)},add(e){!this.includes(e)&&this.push(e)},reset(e){let t=Object.keys(e);return Object.keys(this).forEach(e=>{t.includes(e)||"length"===e||delete this[e]}),b(this,e),this}}),v(V,{object:{get(){let e={};return Object.keys(this).forEach(t=>{let r=this[t];q(r)?e[t]=r.object:e[t]=r}),e}},string:{get(){return JSON.stringify(this.object)}},root:{get(){let e=this;for(;e.parent;)e=e.parent;return e}}});const W=/^_.+|^parent$|^hostkey$|^status$|^length$/;let B={set(e,r,s,n){if(W.test(r))return Reflect.set(e,r,s,n);let i=s;q(s)?s.parent==n?s.hostkey=r:("binding"!==s.status?s.status="binding":s.remove(),s.parent=n,s.hostkey=r,s=s.object):i=T(s,{parent:n,hostkey:r});let a,l=e[r];if(e[j])a=Reflect.set(e,r,i,n);else{if(l===i)return!0;if(q(l)&&q(i)&&l.string===i.string)return!0;let o,h=K(n),c=new t("update",n);e.hasOwnProperty(r)||(o=1),c.modify={genre:o?"set":"change",key:r,value:s,oldVal:l,modifyId:h},a=Reflect.set(e,r,i,n),n.emit(c)}return a},deleteProperty(e,r){if(W.test(r))return Reflect.deleteProperty(e,r);if(!e.hasOwnProperty(r))return!0;let s;e.parent?s=e.parent[e.hostkey]:(Object.values(e).some(e=>{if(q(e))return s=e.parent,!0}),s||(s=new Proxy(e,B)));let n=e[r],i=Reflect.deleteProperty(e,r);q(n)&&M(n);let a=new t("update",s);return a.modify={genre:"delete",key:r,oldVal:n},s.emit(a),i}},J={get(e,t,r){if(/\D/.test(String(t)))return Reflect.get(e,t,r);{let e=k(r.ele).children[t];return e&&A(e)}},set(e,r,s,n){let i,a;if(/\D/.test(r)){if(!e[u]||!e[u].includes(r))return Reflect.set(e,r,s,n);i=e[r],e.ele[p][r]=s}else{s=O(s);let{ele:e}=n;(a=e.getAttribute("xv-shadow"))&&s.ele.setAttribute("xv-shadow",a);let t=n[r];if(t){let{parentElement:e}=t.ele;e.insertBefore(s.ele,t.ele),e.removeChild(t.ele)}else{k(e).appendChild(s.ele)}i=t}let l=K(n),o=new t("update",n);return a&&(o.shadow=a),o.modify={genre:"change",key:r,value:s,oldVal:i,modifyId:l},n.emit(o),!0}},U=function(e){v(this,{[d]:{value:{}},tag:{enumerable:!0,value:e.tagName.toLowerCase()}});h(this,{[I]:{},[_]:{},[C]:[],[S]:[],[N]:""})};const z=(e,t)=>{let r=e[I][t];if(r&&!r.length){let r=e[d][t];e.ele.removeEventListener(t,r),delete e[d][t]}};P=((e,t)=>{let r=[],s=t.k,n=t.v,i=t.type,a=t.eqType,l=l=>{let o=e[l];if(q(o)){L(s,n,i,a,o)&&r.push(o);let e=P(o,t);r.push(...e)}};if(e instanceof U){[...e[u]||[],...Object.keys(k(e.ele).children)].forEach(l)}else Object.keys(e).forEach(l);return l=null,r}),R=((e,t)=>e instanceof U&&t instanceof U?e.ele===t.ele:e===t);let G=U.prototype=Object.create(V);h(G,{on(...e){let r=e[0];if(!this[d][r]){let e;this.ele.addEventListener(r,e=(e=>{e.stopImmediatePropagation();let s=A(e.target),n=new t(r,s),i=s;for(;i.ele!==this.ele;)n.keys.unshift(i.hostkey),i=i.parent;n.originalEvent=e,n.preventDefault=e.preventDefault.bind(e),this.emit(n)})),this[d][r]=e}return V.on.apply(this,e)},one(...e){let t=e[0],r=V.one.apply(this,e);return z(this,t),r},off(...e){let t=e[0],r=V.off.apply(this,e);return z(this,t),r},emit(...e){let r=e[0];if(r instanceof t&&r.shadow&&r.shadow==this.xvRender)return;return V.emit.apply(this,e)},que(e){return ne.que(e,this.ele)}});let Q;v(G,Q={hostkey:{get(){return Array.from(this.ele.parentElement.children).indexOf(this.ele)}},parent:{get(){let e=(e=>{let{parentElement:t}=e;if(t){for(;t.xvContent;)t=t[p].$host.ele;return t}})(this.ele);if(e)return A(e)}},prev:{get(){let{previousElementSibling:e}=this.ele;return e&&A(e)}},next:{get(){let{nextElementSibling:e}=this.ele;return e&&A(e)}},xvele:{get(){let{attributes:e}=this.ele;return e.hasOwnProperty("xv-ele")||e.hasOwnProperty("xv-render")}},class:{get(){return this.ele.classList}},string:{get(){return JSON.stringify(this.object)}},object:{get(){let e={tag:this.tag};if(this.xvRender){let t=this[u];t&&t.forEach(t=>{e[t]=this[t]})}else{let t=this.ele.classList.value;t&&(e.class=t)}return this.forEach((t,r)=>{e[r]=t instanceof U?t.object:t}),e}},length:{get(){return k(this.ele).children.length}}}),Q=Object.keys(Q),["concat","every","filter","find","findIndex","forEach","map","slice","some"].forEach(e=>{let t=Array.prototype[e];t&&h(G,{[e](...e){return t.apply(Array.from(k(this.ele).children).map(e=>A(e)),e)}})});const X=(e,r,s,...i)=>{let{_entrendModifyId:a}=e;a?delete e._entrendModifyId:(a=n(),D(e,a));let l=[],{ele:o}=e,h=k(o),{children:c}=h;for(;s>0;){let e=c[r];l.push(O(e)),h.removeChild(e),s--}let d=c[r],u=o.getAttribute("xv-shadow");r>=0&&d?i.forEach(e=>{let t=O(e).ele;u&&t.setAttribute("xv-shadow",u),h.insertBefore(t,d)}):i.forEach(e=>{let t=O(e).ele;u&&t.setAttribute("xv-shadow",u),h.appendChild(t)});let f=new t("update",e);return u&&(f.shadow=u),f.modify={genre:"arrayMethod",methodName:"splice",args:[r,s,...i],modifyId:a},e.emit(f),l};h(G,{splice(...e){return X(this,...e)},unshift(...e){return X(this,0,0,...e),this.length},push(...e){return X(this,this.length,0,...e),this.length},shift(){return X(this,0,1,...args)},pop(){return X(this,this.length-1,1,...args)},sort(e){let{_entrendModifyId:r}=this;r?delete this._entrendModifyId:(r=n(),D(this,r));let s,i=k(this.ele);if(e instanceof Array){s=[e];let t=Array.from(i.children);e.forEach(e=>{i.appendChild(t[e])})}else{let t=Array.from(i.children).map(e=>A(e)),r=Array.from(t);t.sort(e);let n=[];t.forEach(e=>{n.push(r.indexOf(e))}),t.forEach(e=>{i.appendChild(e.ele)}),s=[n]}let a=new t("update",this);return a.modify={genre:"arrayMethod",methodName:"sort",args:s,modifyId:r},this.emit(a),this},reverse(){let e=k(this.ele);return Array.from(e.children).reverse().forEach(t=>{e.appendChild(t)}),this},indexOf(e){return e instanceof U&&(e=e.ele),Array.from(k(this.ele).children).indexOf(e)},includes(e){return this.indexOf(e)>-1}}),h(G,{before(e){if(/\D/.test(this.hostkey))throw console.error("can't use before in this data =>",this,e),"";return X(this.parent,this.hostkey,0,e),this},after(e){if(/\D/.test(this.hostkey))throw console.error("can't use after in this data =>",this,e),"";return X(this.parent,this.hostkey+1,0,e),this},siblings(e){let t=Array.from(this.ele.parentElement.children),r=t.indexOf(this.ele);return t.splice(r,1),e&&(t=t.filter(t=>{if(w(t,e))return!0})),t.map(e=>A(e))},remove(){if(/\D/.test(this.hostkey))throw console.error(`can't delete this key => ${this.hostkey}`,this,data),"";X(this.parent,this.hostkey,1)},empty(){return this.splice(0,this.length),this},parents(e){let t=[],r=this.parent;if(e){if("string"!=a(e)){if(e instanceof U&&(e=e.ele),e instanceof Element)for(;r&&"html"!=r.tag;){if(r.ele==e)return!0;r=r.parent}return!1}for(;r&&"html"!=r.tag;)w(r.ele,e)&&t.push(r),r=r.parent}else for(;r&&"html"!=r.tag;)t.push(r),r=r.parent;return t},parentsUntil(e){if(e){let t=this.parent;for(;t&&"html"!=t.tag;){if(w(t.ele,e))return t;t=t.parent}}},attr(e,t){if(l(t)){if(!(e instanceof Object))return this.ele.getAttribute(e);Object.keys(e).forEach(t=>{this.attr(t,e[t])})}else{if(this.xvRender){m.get(this.tag).attrs.includes(e)&&(this[e]=t)}this.ele.setAttribute(e,t)}},removeAttr(e){return this.ele.removeAttribute(e),this},is(e){return w(this.ele,e)},que(e){return ne.que(e,this.ele)},queAll(e){return ne.queAll(e,this.ele)}}),v(G,{display:{get(){return getComputedStyle(this.ele).display},set(e){this.ele.style.display=e}},text:{get(){return k(this.ele).textContent},set(e){k(this.ele).textContent=e}},html:{get(){return k(this.ele).innerHTML},set(e){k(this.ele).innerHTML=e}},style:{get(){return this.ele.style},set(e){let{style:t}=this,r=Array.from(t),s=Object.keys(e);r.forEach(e=>{s.includes(e)||(t[e]="")}),b(t,e)}},position:{get(){return{top:this.ele.offsetTop,left:this.ele.offsetLeft}}},offset:{get(){let e={top:0,left:0},t=this.ele;for(;t&&t!==document;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;return e}},width:{get(){return parseInt(getComputedStyle(this.ele).width)}},height:{get(){return parseInt(getComputedStyle(this.ele).height)}},innerWidth:{get(){return this.ele.clientWidth}},innerHeight:{get(){return this.ele.clientHeight}},offsetWidth:{get(){return this.ele.offsetWidth}},offsetHeight:{get(){return this.ele.offsetHeight}},outerWidth:{get(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}},outerHeight:{get(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}}});let Y=100;const Z=e=>{let t=m.get(e.tagName.toLowerCase());if(!t)return void console.warn("not register tag "+e.tagName.toLowerCase());if(e.xvRender)return;let r=Array.from(e.childNodes);e.innerHTML=t.temp;let s=Y++,n=A(e),i=e[p],{proto:a}=t;a&&Object.keys(a).forEach(e=>{g(i,e,{value:a[e]})}),Array.from(e.querySelectorAll("*")).forEach(e=>e.setAttribute("xv-shadow",s)),Array.from(e.querySelectorAll(`[xv-ele][xv-shadow="${s}"]`)).forEach(e=>Z(e)),e.removeAttribute("xv-ele"),e.setAttribute("xv-render",s),g(i,"xvRender",{value:e.xvRender=s});let h=e.querySelector(`[xv-content][xv-shadow="${s}"]`);if(h){for(h.xvContent=s,A(h),g(i,"$content",{get:()=>A(h)}),g(h[p],"$host",{get:()=>A(e)});h.xvRender;){let e=h[p].$content;e&&(h=e.ele)}r.forEach(e=>{h.appendChild(e)})}else r.forEach(t=>{e.appendChild(t)});Array.from(e.querySelectorAll(`[xv-tar][xv-shadow="${s}"]`)).forEach(e=>{let t=e.getAttribute("xv-tar");g(i,"$"+t,{get:()=>A(e)})}),Array.from(e.querySelectorAll(`xv-span[xv-shadow="${s}"]`)).forEach(e=>{var t=document.createTextNode("");e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e);var r=e.getAttribute("xvkey");n.watch(r,e=>{let s=i[r];t.textContent=s})}),Array.from(e.querySelectorAll(`[xv-module][xv-shadow="${s}"]`)).forEach(e=>{let t=e.getAttribute("xv-module"),r=r=>{n[t]=e.value};if(e.xvRender){A(e).watch("value",r)}else e.addEventListener("change",r),e.addEventListener("input",r);n.watch(t,r=>{e.value=n[t]})});let c=t.watch;Object.keys(c).forEach(e=>{n.watch(e,c[e])});let d=b({},t.data);t.attrs.forEach(t=>{let r=e.getAttribute(t);l(r)||null==r||(d[t]=r),n.watch(t,r=>{e.setAttribute(t,r.val)})}),t.props.forEach(t=>{let r=e.getAttribute(t);!l(r)&&null!=r&&(d[t]=r)});let y=Object.keys(d);g(i,u,{value:y}),y.push(...Object.keys(c)),y.forEach(e=>{let t=d[e];t instanceof Object&&(t=o(t),t=T(t,{parent:n,hostkey:e})),l(t)||(n[e]=t)}),y.includes("value")&&g(e,"value",{get:()=>n.value,set(e){n.value=e}}),t.inited&&t.inited.call(n),t.attached&&!e[f]&&e.getRootNode()===document&&(t.attached.call(A(e)),e[f]=1)};let ee=0;const te=()=>{if(ee)return;ee=1;new MutationObserver(e=>{e.forEach(e=>{let{addedNodes:t,removedNodes:r}=e;t&&re(Array.from(t),"attached",f),r&&re(Array.from(r),"detached",y)})}).observe(document.body,{attributes:!1,childList:!0,characterData:!1,subtree:!0})},re=(e,t,r)=>{e.forEach(s=>{s.xvRender&&se(s,t,r),s instanceof Element&&e.forEach(e=>{se(s,t,r)})})},se=(e,t,r)=>{if(!e.xvRender||e[r])return;let s=m.get(e.tagName.toLowerCase());s[t]&&(s[t].call(e,A(e)),e[r]=1)};let ne=e=>{if(e instanceof U)return e;let t=e;return"string"===a(e)&&-1===e.search("<")&&(t=document.querySelector(e)),O(t)};e.$=ne,b(ne,{fn:G,type:a,init:A,que:(e,t=document)=>A(t.querySelector(e)),queAll:(e,t=document)=>Array.from(t.querySelectorAll(e)).map(e=>A(e)),xdata:T,register:e=>{let t={tag:"",temp:"",attrs:[],props:[],data:{},watch:{}};b(t,e),t.attrs=t.attrs.slice(),t.props=t.props.slice(),t.data=o(t.data),t.watch=b({},t.watch);let r=new Set([...t.attrs,...t.props,...Object.keys(t.data)]);if(Q.forEach(t=>{if(r.has(t))throw console.error(`Register illegal key => ${t}`,e),""}),t.temp){let{temp:e}=t,r=document.createElement("div");if(r.innerHTML=e,!r.querySelector("[xv-content]"))throw t.tag+" need container!";var s=(e=e.replace(/<!--.+?-->/g,"")).match(/{{.+?}}/g);s&&s.forEach(t=>{var r=/{{(.+?)}}/.exec(t);r&&(e=e.replace(t,`<xv-span xvkey="${r[1].trim()}"></xv-span>`))}),t.temp=e}(t.attached||t.detached)&&te(),m.set(t.tag,t),Array.from(document.querySelectorAll(t.tag+"[xv-ele]")).forEach(e=>{Z(e)})}}),c(()=>{Array.from(document.querySelectorAll("[xv-ele]")).forEach(e=>{Z(e)})})})(window);